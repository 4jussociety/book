# 물리치료/재활 일정 관리 시스템 페이지 구성 가이드
# 이 문서는 물리치료/재활 일정 관리 시스템의 페이지별 UI/UX 구성 및 상세 기능을 정의합니다.

## 1. 개요

### 1.1 목적
- 병원 내부에서 물리치료/재활 스케줄을 관리하기 위한 웹 시스템 (환자 예약 접수용 아님).

### 1.2 사용자/권한
- **사용자 역할**: 관리자 / 치료사 / 스태프.
- **권한 정책**: 모든 사용자는 동일 스케줄을 열람·생성·수정 가능 (구글 시트처럼 공동 편집).

### 1.3 공통 규칙
- **기반 뷰**: 주간 캘린더 기반, 10분 단위 시간 그리드.
- **예약 생성**: **드래그**가 기본 (클릭/hover 보조).
- **옵션 제외**: 환경설정, OAuth, 알림 발송 API 연동 등은 제외 (문자 "내용 생성/복사"만 제공).

## 2. 페이지 구성 (사이트맵)
1. **로그인**
2. **예약 관리 (캘린더)** (메인)
3. **환자 관리**
4. **통계**
   - (대시보드/공지 등은 예약 관리 페이지 내 위젯으로 통합)

## 3. 로그인 페이지

### 3.1 화면 요소
- 아이디, 비밀번호 입력 필드
- 로그인 버튼

### 3.2 제외 항목
- 비밀번호 찾기 링크 없음.
- OAuth (소셜) 로그인 없음.

## 4. 예약 관리 (캘린더) 페이지

### 4.1 레이아웃/뷰
- **기본 뷰**: 주(Week) 단위 캘린더.
- **트랙 구성**:
  - 치료사 1명: 1개 트랙(컬럼).
  - 치료사 N명: 동일 날짜에 N개의 트랙이 나란히 표시됨 (치료사별 스케줄 비교 용이).

### 4.2 시간 그리드 & 상호작용
- **Grid Snap**: 10분 단위로 스냅(Snap).
- **Drag-to-Create**:
  - 빈 영역 드래그 시 예약 박스 생성 (길이에 따라 10/20/30분...).
  - **드래그 완료(Mouse Up)** 직후 **1차 모달(초진/재진 선택)** 팝업.
- **Hover & Click**:
  - 셀 Hover 시 `+` 버튼 노출.
  - 클릭 시 "기본 10분" 예약 생성 시작 (또는 드래그 유도).
- **Drag-to-Move / Resize**:
  - 예약 박스 몸통 드래그 -> 시간/치료사 이동.
  - 예약 박스 하단 핸들 드래그 -> 시간 길이(Duration) 변경.

### 4.3 예약 생성 UX (State Machine)
1. **Drag End**: `DraftEvent` 생성 (start, end, therapistId 임시 저장).
2. **Modal A (초진/재진 선택)**:
   - `[초진]` 클릭 -> **Modal C (초진 입력)** 로 이동.
   - `[재진]` 클릭 -> **Modal B (환자 검색)** 로 이동.
   - `[취소]` 클릭 -> DraftEvent 삭제.
3. **Modal B (재진 환자 검색)**:
   - 검색어 입력(초성 지원) -> 목록에서 환자 선택 -> **Modal C (재진 입력)** 로 이동 (자동 채움).
4. **Modal C (상세 입력/저장)**:
   - **재진**: 환자 정보 Read-only, `기록(Note)` 필드에 직전 기록 자동 복사.
   - **초진**: 환자 정보 입력 폼 (이름, 핸드폰, 성별, 생년월일 등). `#고객번호`는 자동 할당됨(회색 태그).
   - `[저장]` 클릭 -> API 호출 -> 성공 시 캘린더 반영 (Draft -> Real Event).
   - 실패 시 에러 표시 및 Draft 유지/폐기 선택.

### 4.4 예약 박스 (이벤트) 디자인
- **색상**: 치료사 고유색을 배경/헤더에 적용.
- **상태 표시**: 박스 **좌측 상태 스트립(Strip)** (또는 테두리/아이콘)으로 구분.
  - `예정`: Blue
  - `완료`: Green
  - `취소`: Gray
  - `노쇼`: Red
- **내용**: 환자명 + `#고객번호` + `[n회차]` + 메모(말줄임).

### 4.5 상태 변경 & 자동 완료
- **Manual Change**: 예약 클릭 -> 상세 모달 -> 상태 드롭다운(`예정/완료/취소/노쇼`) 변경.
- **Auto Complete**:
  - 캘린더에 현재 시간 가로선(Now-Line) 표시.
  - 종료 시간(`end_time`)이 지난 예약은 자동으로 `완료` 스타일 및 라벨 표시.
  - (서버 상태 반영은 백그라운드 로직에 따름, UI는 시간 기준 즉시 반영).
  - 자동 완료 후에도 수동으로 `취소/노쇼` 변경 가능.

### 4.6 검색 UX (구분 필수)
- **캘린더 내 찾기 (Find)**:
  - 위치: 우측 상단 검색창.
  - 기능: 현재 화면(View) 내 예약 하이라이트/점프 (Ctrl+F 개념).
- **환자 선택 검색 (Select)**:
  - 위치: 예약 생성 플로우의 **Modal B**.
  - 기능: DB 전체 환자 검색 및 선택.

### 4.7 예약 잠금 (Block Time)
- **목적**: 점심, 회의, 휴가 등 예약 불가 시간.
- **생성**: "잠금 모드" 또는 별도 버튼 -> 드래그 -> `BLOCK` 타입 생성 (회색 스타일).
- **반복**: 매일 점심시간 등 반복 설정 가능.

### 4.8 문자 생성 (Copy Only)
- **위치**: 예약 상세 모달 내 `[문자 생성]` 버튼.
- **동작**: 클릭 시 템블릿 변수 치환된 텍스트가 `Textarea`나 `Preview`에 표시됨.
- **기능**: `[복사]` 버튼 클릭 시 클립보드에 복사 (외부 발송 툴에 붙여넣기).

### 4.9 공동 편집 (Concurrency) - 충돌 처리
- **수정 시**: `version` 체크.
- **충돌 발생 (409)**:
  - "다른 사용자가 수정했습니다." 알림 모달.
  - `[새로고침]` 버튼 제공 -> 최신 데이터(`GET`) 로드 후 다시 편집 유도.

## 5. 환자 관리 페이지
- **목록**: 이름, #고객번호, 핸드폰, 성별, 생년월일, 담당치료사, 최근/최초 방문일.
- **등록/수정**: 캘린더의 **초진 등록 모달**과 동일 폼 사용 (별도 페이지 아님).
- **예약 잡기**: 목록에서 선택 -> 캘린더 이동 -> 다음 드래그 시 해당 환자 자동 선택(재진 플로우).

## 6. 통계 페이지
- **기간**: 오늘/주간/월간/지정.
- **지표**:
  - 예약/완료/취소/노쇼 건수 및 노쇼율.
  - 치료사별 실적 (건수, 신환, 재방문, 평균시간).
- **매출**: 완료 건에 대한 `치료 항목/단가` 합계 (치료사별/항목별).
- **내보내기**: CSV 다운로드.

## 7. 예외 처리 및 비기능 요구사항
### 7.1 데이터 검증
- **시간**: 10분 단위 준수 (서버 검증). `end > start`.
- **필수값**: 이름 (성별/생년월일은 v1 필수 권장).
- **중복**: 동일 치료사 트랙 시간 겹침 차단 (Block 포함).

### 7.2 에러 코드 대응 (UI)
- `409 TIME_OVERLAP`: "이미 예약된 시간입니다."
- `409 VERSION_CONFLICT`: "데이터가 변경되었습니다. 새로고침 해주세요."
- `409 PATIENT_NO_DUPLICATE`: "이미 존재하는 고객번호입니다."
- `400 INVALID_TIME_GRID`: "10분 단위로 설정해주세요."
